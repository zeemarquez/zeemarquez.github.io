<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zee Marquez">
<meta name="dcterms.date" content="2022-12-07">

<title>zeemarquez.github.io - Finite Element Method</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-MLEV5LTVX2"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-MLEV5LTVX2', { 'anonymize_ip': true});
</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="zeemarquez.github.io - Finite Element Method">
<meta property="og:description" content="The finite element method is a numerical technique used to solve complex engineering and physical problems.">
<meta property="og:image" content="https://zeemarquez.github.io/posts/fem/pictures/vonmises_highres_y_log.png">
<meta property="og:site-name" content="zeemarquez.github.io">
<meta name="twitter:title" content="zeemarquez.github.io - Finite Element Method">
<meta name="twitter:description" content="The finite element method is a numerical technique used to solve complex engineering and physical problems.">
<meta name="twitter:image" content="https://zeemarquez.github.io/posts/fem/pictures/vonmises_highres_y_log.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">zeemarquez.github.io</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">Sobre mi</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <div class="quarto-title-block"><div><h1 class="title">Finite Element Method</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                                <div class="quarto-categories">
                <div class="quarto-category">Python</div>
                <div class="quarto-category">FEM</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Zee Marquez </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 7, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#requirements" id="toc-requirements" class="nav-link" data-scroll-target="#requirements">Requirements</a></li>
  <li><a href="#mesh" id="toc-mesh" class="nav-link" data-scroll-target="#mesh">Mesh</a>
  <ul class="collapse">
  <li><a href="#node" id="toc-node" class="nav-link" data-scroll-target="#node">Node</a></li>
  <li><a href="#element" id="toc-element" class="nav-link" data-scroll-target="#element">Element</a></li>
  </ul></li>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">Preprocessing</a>
  <ul class="collapse">
  <li><a href="#extract-mesh-data" id="toc-extract-mesh-data" class="nav-link" data-scroll-target="#extract-mesh-data">Extract mesh data</a></li>
  <li><a href="#material-properties" id="toc-material-properties" class="nav-link" data-scroll-target="#material-properties">Material properties</a></li>
  <li><a href="#boundary-conditions-and-forces" id="toc-boundary-conditions-and-forces" class="nav-link" data-scroll-target="#boundary-conditions-and-forces">Boundary conditions and forces</a></li>
  </ul></li>
  <li><a href="#stiffness-matrix-assembly" id="toc-stiffness-matrix-assembly" class="nav-link" data-scroll-target="#stiffness-matrix-assembly">Stiffness matrix assembly</a></li>
  <li><a href="#solver" id="toc-solver" class="nav-link" data-scroll-target="#solver">Solver</a></li>
  <li><a href="#postprocessing" id="toc-postprocessing" class="nav-link" data-scroll-target="#postprocessing">Postprocessing</a>
  <ul class="collapse">
  <li><a href="#von-mises-stress" id="toc-von-mises-stress" class="nav-link" data-scroll-target="#von-mises-stress">Von-Mises Stress</a></li>
  <li><a href="#mesh-deformation-and-coloring" id="toc-mesh-deformation-and-coloring" class="nav-link" data-scroll-target="#mesh-deformation-and-coloring">Mesh deformation and Coloring</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">




<p>The finite element method is a numerical technique used to solve complex engineering and physical problems. It is a powerful tool that allows for the accurate prediction of the behavior of a system under a wide range of conditions, making it an essential tool for engineers and scientists working in fields such as structural analysis, fluid dynamics, and electromagnetics. In this blog post, we will explore the basics of the finite element method and how it is used to solve real-world problems using Python. Whether you are an experienced engineer or a curious learner, I hope that this post will provide you with a better understanding of this important and versatile method.</p>
<p>By the end of this tutorial, you will be able to use Python to implement the finite element method and apply it to solve simple problems.</p>
<p>All the code can be find <a href="https://github.com/zeemarquez/FEM">here</a>.</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The Finite Element Method works by divinding a physical space into diferent elements and the governing equations are applied for each element. This is very useful for complex geometries or boundary conditions were obtaining an analytical expression is not feassible.</p>
<p>Altough FEM can be applied for many different phypical problems, it is more comonly used in structural analysis. Therefore will be developing the FEM for structural analysis in 2D. In this example the structural case will be a 2D rectangular plate (5mx10m) with an hole (1m), fixed on one side and subjected to a constant tension force of 1 kN on the opposite side:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/structural_case.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
<p>To simplify the problem 3-node triangular elements will be used.</p>
<p>The main equation in the FEM for structural analysis is the following: <span class="math display">\[\textbf{K} \textbf{d} = \textbf{F}\]</span> Where <span class="math inline">\(\textbf{d}\)</span> is the displacement vector, <span class="math inline">\(\textbf{F}\)</span> is the force vector and <span class="math inline">\(\textbf{K}\)</span> is the stiffness matrix. The displacemnet vector contains the displacements of the nodes, the force vector is composed by the external forces and the rection forces of the nodes. For the rest of this example the force vector will be expressed as the sum of the external forces (<span class="math inline">\(\textbf{f}\)</span>) and the rection forces (<span class="math inline">\(\textbf{r}\)</span>): <span class="math display">\[\textbf{K} \textbf{d} = \textbf{f} + \textbf{r}\]</span></p>
<p>While the displacemts and forces seem quite intuitive to understand, the stiffnes matrix is a bit more abstract. It represents the resistance to deformation. It is analogus to the spring constant (<span class="math inline">\(k\)</span>) in <a href="https://en.wikipedia.org/wiki/Hooke%27s_law">Hooke’s law</a>: <span class="math display">\[ F = kx \]</span></p>
</section>
<section id="requirements" class="level1">
<h1>Requirements</h1>
<p>To run this code some libraries are required:</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install numpy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb2"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pygmsh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb3"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install gmsh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>Terminal</strong></pre>
</div>
<div class="sourceCode" id="cb4"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pytglet</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To start we must import some libraries, including <code>numpy</code>, <code>pygmsh</code>, and <code>gmsh</code>. NumPy is a library for scientific computing in Python, and is often used for numerical calculations and data manipulation. The <code>math</code> library provides mathematical functions. The library <code>drawMesh</code> is a simple mesh visualization library based on <code>pyglet</code> developed for this project, it can be found in the <a href="(https://github.com/zeemarquez/FEM)">GitHub repository</a>. Finally, <code>gmsh</code> is a powerful mesh generation software that can be used in conjunction with <code>pygmsh</code>. Together, these libraries provide the tools necessary to implement the finite element method in Python.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> <span class="op">*</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> drawMesh</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pygmsh</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gmsh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mesh" class="level1">
<h1>Mesh</h1>
<p>The separation of the geometry into elements and nodes can be done manually but it becomes exponetially difficult for complex geometries and finer mesh resolutions. Therefore we make use of <code>gmsh</code>, a powerful meshing tool.</p>
<p>We create the mesh using <code>pygmsh</code>. The mesh resolution is defined in the variable <code>resolution</code>. The lower the value of <code>resolution</code>, the more the mesh will be divided into elements. This will lead to better results but higher computational cost. On of the key aspects of FEM is to balance between mesh resolution and computing power.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>gmsh.initialize()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>rect_width, rect_length  <span class="op">=</span> <span class="fl">3.0</span>, <span class="fl">10.0</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>resolution <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>geom <span class="op">=</span> pygmsh.geo.Geometry()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>circle <span class="op">=</span> geom.add_circle(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">5</span>,<span class="fl">1.5</span>,<span class="dv">0</span>],</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    radius<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    mesh_size<span class="op">=</span>resolution<span class="op">*</span><span class="fl">0.5</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    make_surface<span class="op">=</span><span class="va">False</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>rect <span class="op">=</span> geom.add_polygon(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">0.0</span>, <span class="fl">0.0</span>                ,<span class="dv">0</span>],</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">0.0</span>, rect_width         ,<span class="dv">0</span>],</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        [rect_length, rect_width ,<span class="dv">0</span>],</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        [rect_length, <span class="fl">0.0</span>        ,<span class="dv">0</span>],</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    mesh_size<span class="op">=</span>resolution , holes <span class="op">=</span> [circle]</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>mesh <span class="op">=</span> geom.generate_mesh(dim<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>geom.<span class="fu">__exit__</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The resultant mesh looks like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/mesh.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
<p>This mesh is composed of many nodes, that form triangular elements. Many nodes are shared by different by multiple elements.</p>
<section id="node" class="level2">
<h2 class="anchored" data-anchor-id="node">Node</h2>
<p>The following code defines the <code>Node</code> class, which represents a node in a mesh. The class has several attributes and methods that are used to store and manipulate information about the node, such as its coordinates, forces, and displacements.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/node_element.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
<p>The init method is used to initialize a new Node object, and accepts the node’s id, x and y coordinates as arguments. The fx and fy attributes are used to store the external forces applied to the node, and the rx and ry attributes are used to store the reaction forces at the node. The dx and dy attributes are used to store the displacements of the node.</p>
<p>The dfix property returns a Boolean value indicating whether the node is fixed in both x and y directions. The externalForce property returns a Boolean value indicating whether the node has any external forces applied to it. The eq method is used to compare two Node objects and returns a Boolean value indicating whether they are at the same location. This class can be used to represent nodes in a mesh and perform operations on them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, <span class="bu">id</span>, x, y):</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x, <span class="va">self</span>.y <span class="op">=</span> x, y</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fx, <span class="va">self</span>.fy <span class="op">=</span> <span class="fl">0.0</span>, <span class="fl">0.0</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.rx, <span class="va">self</span>.ry <span class="op">=</span> <span class="fl">0.0</span> ,<span class="fl">0.0</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dx, <span class="va">self</span>.dy <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dfix(<span class="va">self</span>):</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dx <span class="op">==</span> <span class="fl">0.0</span> <span class="kw">and</span> <span class="va">self</span>.dy <span class="op">==</span> <span class="fl">0.0</span>:</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> externalForce(<span class="va">self</span>):</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.fx <span class="op">!=</span> <span class="fl">0.0</span> <span class="kw">or</span> <span class="va">self</span>.fy <span class="op">!=</span> <span class="fl">0.0</span>:</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, obj):</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="va">self</span>.x <span class="op">==</span> obj.x) <span class="kw">and</span> (<span class="va">self</span>.y <span class="op">==</span> obj.y):</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span>       </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="element" class="level2">
<h2 class="anchored" data-anchor-id="element">Element</h2>
<p>Each element contains a series of nodes. In this case, we are using triangular nodes therefore each element has three nodes. It is important for the calculations that the nodes in each element are ordered counter-clockwise, therefore the passed nodes in the initialization are ordered with the <code>orderCounterClock()</code> method. Each element contains a <code>stress</code> (<span class="math inline">\(\vec{\sigma}\)</span>) and a <code>strain</code> (<span class="math inline">\(\vec{\varepsilon}\)</span>) attributes:</p>
<p><span class="math display">\[\begin{equation}

\vec{\sigma} =  \begin{bmatrix}
\sigma_{xx}\\
\sigma_{yy}\\
\sigma_{xy}\\
\end{bmatrix}

\hspace{10mm}

\vec{\varepsilon} =  \begin{bmatrix}
\varepsilon_{xx}\\
\varepsilon_{yy}\\
\gamma_{xy}\\
\end{bmatrix}

\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\mathbf{d^e} =  \begin{bmatrix}
d_{0,x}^e\\
d_{0,y}^e\\
d_{1,x}^e\\
d_{1,y}^e\\
d_{2,x}^e\\
d_{2,y}^e\\
\end{bmatrix}

\hspace{5mm}

\mathbf{K^e} = \begin{bmatrix}
k_{00} &amp; k_{01} &amp; k_{02} &amp; k_{03} &amp; k_{04} &amp; k_{05} &amp; \\
k_{10} &amp; k_{11} &amp; k_{12} &amp; k_{13} &amp; k_{14} &amp; k_{15} &amp; \\
k_{20} &amp; k_{21} &amp; k_{22} &amp; k_{23} &amp; k_{24} &amp; k_{25} &amp; \\
k_{30} &amp; k_{31} &amp; k_{32} &amp; k_{33} &amp; k_{34} &amp; k_{35} &amp; \\
k_{40} &amp; k_{41} &amp; k_{42} &amp; k_{43} &amp; k_{44} &amp; k_{45} &amp; \\
k_{50} &amp; k_{51} &amp; k_{52} &amp; k_{53} &amp; k_{54} &amp; k_{55} &amp; \\
\end{bmatrix}

\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\mathbf{K^e} = \int_{\Omega}(\mathbf{B^e})^T \mathbf{D} \hspace{1mm} \mathbf{B^e} d \Omega = (\mathbf{B^e})^T \mathbf{D} \hspace{1mm} \mathbf{B^e}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}

\mathbf{B^e} =  \frac{1}{2 A^e} \begin{bmatrix}
(y_1^e - y_2^e) &amp; 0 &amp; (y_2^e - y_0^e) &amp; 0 &amp; (y_0^e - y_1^e) &amp; 0 &amp; \\
0 &amp; (x_2^e - x_1^e) &amp; 0 &amp; (x_0^e - x_2^e) &amp; 0 &amp; (x_1^e - x_0^e) &amp; \\
(x_2^e - x_1^e) &amp; (y_1^e - y_2^e) &amp; (x_0^e - x_2^e) &amp; (y_2^e - y_0^e) &amp; (x_1^e - x_0^e) &amp; (y_0^e - y_1^e) &amp; \\
\end{bmatrix}


\end{equation}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Element:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    maxColorVal <span class="op">=</span> <span class="op">-</span><span class="fl">9.9e19</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    minColorVal <span class="op">=</span> <span class="fl">9.9e19</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    colorFunc <span class="op">=</span> <span class="kw">lambda</span> x: x</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, <span class="bu">id</span>, nodes):</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.nodes <span class="op">=</span> <span class="va">self</span>.orderCounterClock(nodes)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stress <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.strain <span class="op">=</span> <span class="va">None</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.colorVal <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.getArea()</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getmaxColorVal(<span class="va">self</span>):</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Element.maxColorVal</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getminColorVal(<span class="va">self</span>):</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Element.minColorVal</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getcolorFunc(<span class="va">self</span>):</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Element.colorFunc</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getde(<span class="va">self</span>):</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        de_ <span class="op">=</span> []</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n <span class="kw">in</span> <span class="va">self</span>.nodes:</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            de_.append(n.dx)</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            de_.append(n.dy)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.de <span class="op">=</span> np.array(de_)</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.de</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getColor(<span class="va">self</span>):</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>: x_ <span class="op">=</span> <span class="bu">float</span>(<span class="va">self</span>.colorVal <span class="op">-</span> Element.minColorVal)<span class="op">/</span>(Element.maxColorVal <span class="op">-</span> Element.minColorVal)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ZeroDivisionError</span>: x_ <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># cmax == cmin</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> Element.colorFunc(x_)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>        blue  <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>(<span class="fl">0.75</span><span class="op">-</span>x), <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        red   <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>(x<span class="op">-</span><span class="fl">0.25</span>), <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        green <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>fabs(x<span class="op">-</span><span class="fl">0.5</span>)<span class="op">-</span><span class="fl">1.</span>, <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (red, green, blue)</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getArea(<span class="va">self</span>):</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>        x1,y1 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">0</span>].x, <span class="va">self</span>.nodes[<span class="dv">0</span>].y</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>        x2,y2 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">1</span>].x, <span class="va">self</span>.nodes[<span class="dv">1</span>].y</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        x3,y3 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">2</span>].x, <span class="va">self</span>.nodes[<span class="dv">2</span>].y</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> <span class="fl">0.5</span><span class="op">*</span>((x2<span class="op">*</span>y3 <span class="op">-</span> x3<span class="op">*</span>y2)<span class="op">-</span>(x1<span class="op">*</span>y3<span class="op">-</span> x3<span class="op">*</span>y1)<span class="op">+</span>(x1<span class="op">*</span>y2<span class="op">-</span>x2<span class="op">*</span>y1))</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> result <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> <span class="fl">1e-20</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.area <span class="op">=</span> result</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getBe(<span class="va">self</span>):</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>        x1,y1 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">0</span>].x, <span class="va">self</span>.nodes[<span class="dv">0</span>].y</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>        x2,y2 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">1</span>].x, <span class="va">self</span>.nodes[<span class="dv">1</span>].y</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>        x3,y3 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">2</span>].x, <span class="va">self</span>.nodes[<span class="dv">2</span>].y</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        B <span class="op">=</span> (<span class="fl">0.5</span><span class="op">/</span><span class="va">self</span>.area) <span class="op">*</span> np.array([</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>            [(y2<span class="op">-</span>y3) ,  <span class="dv">0</span>    , (y3<span class="op">-</span>y1),  <span class="dv">0</span>   ,   (y1<span class="op">-</span>y2),   <span class="dv">0</span>   ],</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>            [   <span class="dv">0</span>    , (x3<span class="op">-</span>x2),  <span class="dv">0</span>    , (x1<span class="op">-</span>x3),     <span class="dv">0</span>   ,(x2<span class="op">-</span>x1)],</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>            [(x3<span class="op">-</span>x2) , (y2<span class="op">-</span>y3), (x1<span class="op">-</span>x3), (y3<span class="op">-</span>y1), (x2<span class="op">-</span>x1) ,(y1<span class="op">-</span>y2)],</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>        ], dtype<span class="op">=</span>np.float64)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Be <span class="op">=</span> B</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> B</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getKe(<span class="va">self</span>, D):</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>        Bie <span class="op">=</span> <span class="va">self</span>.getBe()</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        Ke <span class="op">=</span> <span class="va">self</span>.area<span class="op">*</span> np.matmul(Bie.T, np.matmul(D, Bie))</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Ke <span class="op">=</span> Ke</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Ke</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> orderCounterClock(<span class="va">self</span>, nodes):</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>        p1,p2,p3 <span class="op">=</span> nodes[<span class="dv">0</span>], nodes[<span class="dv">1</span>], nodes[<span class="dv">2</span>]</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> (p2.y <span class="op">-</span> p1.y) <span class="op">*</span> (p3.x <span class="op">-</span> p2.x) <span class="op">-</span> (p2.x <span class="op">-</span> p1.x) <span class="op">*</span> (p3.y <span class="op">-</span> p2.y)</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        nodes_ <span class="op">=</span> nodes.copy()</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>            nodes[<span class="dv">1</span>] <span class="op">=</span> nodes_[<span class="dv">0</span>]</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>            nodes[<span class="dv">0</span>] <span class="op">=</span> nodes_[<span class="dv">1</span>]   </span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>        assembly <span class="op">=</span> []</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n <span class="kw">in</span> nodes:</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>            assembly.append(<span class="bu">int</span>(n.<span class="bu">id</span><span class="op">*</span><span class="dv">2</span>))</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>            assembly.append(<span class="bu">int</span>(n.<span class="bu">id</span><span class="op">*</span><span class="dv">2</span>) <span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assembly <span class="op">=</span> assembly</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> nodes    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="preprocessing" class="level1">
<h1>Preprocessing</h1>
<section id="extract-mesh-data" class="level2">
<h2 class="anchored" data-anchor-id="extract-mesh-data">Extract mesh data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>maxNode <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cell <span class="kw">in</span> mesh.cells[<span class="dv">1</span>].data:</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node <span class="kw">in</span> cell:</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node <span class="op">&gt;</span> maxNode:</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            maxNode <span class="op">=</span> node</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>meshCells <span class="op">=</span> mesh.cells[<span class="dv">1</span>].data <span class="op">-</span> np.full(np.shape(mesh.cells[<span class="dv">1</span>].data), <span class="dv">1</span>, dtype<span class="op">=</span>np.uint64)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>meshPoints <span class="op">=</span> mesh.points[<span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>nodes <span class="op">=</span> [Node(i, point[<span class="dv">0</span>], point[<span class="dv">1</span>]) <span class="cf">for</span> i, point <span class="kw">in</span> <span class="bu">enumerate</span>(meshPoints)]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>elements <span class="op">=</span> []</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,cell <span class="kw">in</span> <span class="bu">enumerate</span>(meshCells):</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    elements.append(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        Element(<span class="bu">id</span><span class="op">=</span>i, nodes<span class="op">=</span>[nodes[i] <span class="cf">for</span> i <span class="kw">in</span> cell])</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="material-properties" class="level2">
<h2 class="anchored" data-anchor-id="material-properties">Material properties</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> <span class="fl">0.28</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>E <span class="op">=</span> <span class="fl">200.0e9</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> (E<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>v<span class="op">**</span><span class="dv">2</span>)) <span class="op">*</span> np.array([</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, v, <span class="dv">0</span>],</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    [v, <span class="dv">1</span>, <span class="dv">0</span>],</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="dv">0</span>, (<span class="dv">1</span><span class="op">-</span>v)<span class="op">/</span><span class="dv">2</span>],</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="boundary-conditions-and-forces" class="level2">
<h2 class="anchored" data-anchor-id="boundary-conditions-and-forces">Boundary conditions and forces</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, node <span class="kw">in</span> <span class="bu">enumerate</span>(nodes):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node.x <span class="op">==</span> rect_length:           <span class="co"># At right side of the rectangle (x=10)</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        node.fx <span class="op">=</span> <span class="fl">1.0e3</span>                 <span class="co"># Apply a downwards force of 1kN</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> node.x <span class="op">==</span> <span class="fl">0.0</span>:                 <span class="co"># At left side of the rectangle (x=0)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        node.dx, node.dy <span class="op">=</span> <span class="fl">0.0</span>, <span class="fl">0.0</span>     <span class="co"># Fix the displacement in x and y</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        node.rx, node.ry <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span>   <span class="co"># Set the reaction forces as unknowns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="stiffness-matrix-assembly" class="level1">
<h1>Stiffness matrix assembly</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/node_assembly.png" class="img-fluid figure-img" style="width:75.0%"></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assemblyK(K, Ke, nodeAssembly):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i,t <span class="kw">in</span> <span class="bu">enumerate</span>(nodeAssembly):</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j,s <span class="kw">in</span> <span class="bu">enumerate</span>(nodeAssembly):</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>            K[t][s] <span class="op">+=</span> Ke[i][j]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
\mathbf{K} = \sum_{i = 0}^{N_{el}} \mathbf{\hat{K}^e}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Nnodes <span class="op">=</span> <span class="bu">len</span>(nodes)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> np.zeros((Nnodes<span class="op">*</span><span class="dv">2</span>,Nnodes<span class="op">*</span><span class="dv">2</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>B_list <span class="op">=</span> []</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> e <span class="kw">in</span> elements:</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    Ke <span class="op">=</span> e.getKe(D)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    nodeAssembly <span class="op">=</span> e.assembly</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    assemblyK(K, Ke, nodeAssembly)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[Kd = f + r\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.zeros((<span class="bu">int</span>(<span class="dv">2</span><span class="op">*</span>Nnodes), <span class="dv">1</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> np.full((<span class="bu">int</span>(<span class="dv">2</span><span class="op">*</span>Nnodes), <span class="dv">1</span>), <span class="va">None</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.full((<span class="bu">int</span>(<span class="dv">2</span><span class="op">*</span>Nnodes), <span class="dv">1</span>), <span class="va">None</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>rowsrk, rowsdk <span class="op">=</span> [], []</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,node <span class="kw">in</span> <span class="bu">enumerate</span>(nodes):</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    ix,iy <span class="op">=</span> <span class="bu">int</span>(i<span class="op">*</span><span class="dv">2</span>), <span class="bu">int</span>(i<span class="op">*</span><span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    f[ix], f[iy] <span class="op">=</span> node.fx, node.fy</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    d[ix], d[iy] <span class="op">=</span> node.dx, node.dy</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    r[ix], r[iy] <span class="op">=</span> node.rx, node.ry</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node.dx <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        rowsrk.append(ix)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        rowsdk.append(ix)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node.dy <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        rowsrk.append(iy)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        rowsdk.append(iy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="solver" class="level1">
<h1>Solver</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>KB <span class="op">=</span> np.zeros((<span class="bu">len</span>(rowsrk),<span class="bu">len</span>(rowsrk)))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>KA <span class="op">=</span> np.zeros((<span class="bu">len</span>(rowsdk),<span class="bu">len</span>(rowsrk)))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>fk <span class="op">=</span> np.array([r[i] <span class="cf">for</span> i <span class="kw">in</span> rowsrk]) <span class="op">+</span> np.array([f[i] <span class="cf">for</span> i <span class="kw">in</span> rowsrk])</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>dk <span class="op">=</span> np.array([d[i] <span class="cf">for</span> i <span class="kw">in</span> rowsdk]) </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(np.shape(KB)[<span class="dv">0</span>]):</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(np.shape(KB)[<span class="dv">1</span>]):</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        KB[i][j] <span class="op">=</span> K [rowsrk[i]][rowsrk[j]]</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(np.shape(KA)[<span class="dv">0</span>]):</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(np.shape(KA)[<span class="dv">1</span>]):</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        KA[i][j] <span class="op">=</span> K [rowsdk[i]][rowsrk[j]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
\mathbf{d_U} = \mathbf{K_B}^{-1} \mathbf{f_K} \hspace{10mm} \mathbf{f_U} = \mathbf{K_A} \mathbf{d_U}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>du <span class="op">=</span> np.matmul(np.linalg.inv(KB), fk)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fu <span class="op">=</span> np.matmul(KA,du)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="postprocessing" class="level1">
<h1>Postprocessing</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>d_total <span class="op">=</span> d.copy()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, d_solve <span class="kw">in</span> <span class="bu">zip</span>(rowsrk, du):</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    d_total[i] <span class="op">=</span> d_solve</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,n <span class="kw">in</span> <span class="bu">enumerate</span>(nodes):</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    ix,iy <span class="op">=</span> <span class="bu">int</span>(i<span class="op">*</span><span class="dv">2</span>), <span class="bu">int</span>(i<span class="op">*</span><span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    n.dx <span class="op">=</span> d_total[ix][<span class="dv">0</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    n.dy <span class="op">=</span> d_total[iy][<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="von-mises-stress" class="level2">
<h2 class="anchored" data-anchor-id="von-mises-stress">Von-Mises Stress</h2>
<p><span class="math display">\[
\sigma_v = \sqrt{\sigma_{xx} + \sigma_{yy} + 3\sigma_{xy}^2 - \sigma_{xx}\sigma_{yy} }
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculateVonMises(sx, sy, sxy):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sqrt(sx<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> sy<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>(sxy<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> sx<span class="op">*</span>sy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mesh-deformation-and-coloring" class="level2">
<h2 class="anchored" data-anchor-id="mesh-deformation-and-coloring">Mesh deformation and Coloring</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rgb(mag, cmin, cmax):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>: x <span class="op">=</span> <span class="bu">float</span>(mag<span class="op">-</span>cmin)<span class="op">/</span>(cmax<span class="op">-</span>cmin)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ZeroDivisionError</span>: x <span class="op">=</span> <span class="fl">0.5</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    blue  <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>(<span class="fl">0.75</span><span class="op">-</span>x), <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    red   <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>(x<span class="op">-</span><span class="fl">0.25</span>), <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>fabs(x<span class="op">-</span><span class="fl">0.5</span>)<span class="op">-</span><span class="fl">1.</span>, <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (red, green, blue)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>average <span class="op">=</span> <span class="kw">lambda</span> x: (<span class="bu">sum</span>(x)<span class="op">/</span><span class="bu">len</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>maxd, mind <span class="op">=</span> <span class="bu">max</span>(d_total)[<span class="dv">0</span>], <span class="bu">min</span>(d_total)[<span class="dv">0</span>]</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>Element.colorFunc <span class="op">=</span> <span class="kw">lambda</span> x: x <span class="co">#exp(-x)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
\varepsilon^e = \mathbf{B}^e \mathbf{d}^e \hspace{20mm} \sigma^e = \mathbf{D} \varepsilon^e
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,element <span class="kw">in</span> <span class="bu">enumerate</span>(elements):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    de <span class="op">=</span> element.getde()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    strain_e <span class="op">=</span> np.matmul(element.Be,de)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    stress_e <span class="op">=</span> np.matmul(D, strain_e)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    dx_avg <span class="op">=</span> average([de[<span class="dv">0</span>], de[<span class="dv">2</span>], de[<span class="dv">4</span>]])</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    dy_avg <span class="op">=</span> average([de[<span class="dv">1</span>], de[<span class="dv">3</span>], de[<span class="dv">5</span>]])</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    element.strain <span class="op">=</span> strain_e</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    element.stress <span class="op">=</span> stress_e</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    element.colorVal <span class="op">=</span> calculateVonMises(element.stress[<span class="dv">0</span>], element.stress[<span class="dv">1</span>], element.stress[<span class="dv">2</span>])</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> element.colorVal <span class="op">&gt;</span> Element.maxColorVal:</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        Element.maxColorVal <span class="op">=</span> element.colorVal</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> element.colorVal <span class="op">&lt;</span> Element.minColorVal:</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        Element.minColorVal <span class="op">=</span> element.colorVal</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>render <span class="op">=</span> drawMesh.MeshRender()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>render.legend <span class="op">=</span> <span class="va">True</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>render.autoScale <span class="op">=</span> <span class="va">True</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>render.deform_scale <span class="op">=</span> <span class="fl">1.0e5</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>render.legendDiscretize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>render.legendTitle <span class="op">=</span> <span class="st">'von-mises (Pa)'</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>render.drawElements(elements)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/vonmises_highres_x.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>
<p>If we rerun the code changing the force direction downwards we get the following result:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pictures/vonmises_highres_y_log.png" class="img-fluid figure-img" style="width:100.0%"></p>
</figure>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb25" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Finite Element Method"</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Zee Marquez"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2022-12-07"</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span><span class="co"> [Python, FEM]</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> "pictures/vonmises_highres_y_log.png"</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="an">lang:</span><span class="co"> en</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="an">page-layout:</span><span class="co"> full</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="an">linestretch:</span><span class="co"> 1.75</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="an">fig-cap-location:</span><span class="co"> top</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">  - shinylive</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">  enabled: false</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="an">twitter-card:</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">  image: "https://zeemarquez.github.io/posts/fem/pictures/vonmises_highres_y_log.png"</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="an">open-graph:</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">  image: "https://zeemarquez.github.io/posts/fem/pictures/vonmises_highres_y_log.png"</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>The finite element method is a numerical technique used to solve complex engineering and physical problems. It is a powerful tool that allows for the accurate prediction of the behavior of a system under a wide range of conditions, making it an essential tool for engineers and scientists working in fields such as structural analysis, fluid dynamics, and electromagnetics. In this blog post, we will explore the basics of the finite element method and how it is used to solve real-world problems using Python. Whether you are an experienced engineer or a curious learner, I hope that this post will provide you with a better understanding of this important and versatile method.</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>By the end of this tutorial, you will be able to use Python to implement the finite element method and apply it to solve simple problems.</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>All the code can be find <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/zeemarquez/FEM)</span>.</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>The Finite Element Method works by divinding a physical space into diferent elements and the governing equations are applied for each element. This is very useful for complex geometries or boundary conditions were obtaining an analytical expression is not feassible.</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>Altough FEM can be applied for many different phypical problems, it is more comonly used in structural analysis. Therefore will be developing the FEM for structural analysis in 2D. </span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>In this example the structural case will be a 2D rectangular plate (5mx10m) with an hole (1m), fixed on one side and subjected to a constant tension force of 1 kN on the opposite side:</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a><span class="al">![](pictures/structural_case.png)</span>{width=75% fig-align="center"}</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>To simplify the problem 3-node triangular elements will be used. </span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>The main equation in the FEM for structural analysis is the following:</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>$$\textbf{K} \textbf{d} = \textbf{F}$$</span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>Where $\textbf{d}$ is the displacement vector, $\textbf{F}$ is the force vector and $\textbf{K}$ is the stiffness matrix. The displacemnet vector contains the displacements of the nodes, the force vector is composed by the external forces and the rection forces of the nodes. For the rest of this example the force vector will be expressed as the sum of the external forces ($\textbf{f}$) and the rection forces ($\textbf{r}$):</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>$$\textbf{K} \textbf{d} = \textbf{f} + \textbf{r}$$</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a>While the displacemts and forces seem quite intuitive to understand, the stiffnes matrix is a bit more abstract. It represents the resistance to deformation. It is analogus to the spring constant ($k$) in <span class="co">[</span><span class="ot">Hooke's law</span><span class="co">](https://en.wikipedia.org/wiki/Hooke%27s_law)</span>:</span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>$$ F = kx $$</span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a><span class="fu"># Requirements</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>To run this code some libraries are required:</span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a><span class="in">```{.zsh filename="Terminal"}</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install numpy</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{.zsh filename="Terminal"}</span></span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pygmsh</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a><span class="in">```{.zsh filename="Terminal"}</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install gmsh</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a><span class="in">```{.zsh filename="Terminal"}</span></span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pytglet</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a>To start we must import some libraries, including <span class="in">`numpy`</span>, <span class="in">`pygmsh`</span>, and <span class="in">`gmsh`</span>. NumPy is a library for scientific computing in Python, and is often used for numerical calculations and data manipulation. The <span class="in">`math`</span> library provides mathematical functions. The library <span class="in">`drawMesh`</span> is a simple mesh visualization library based on <span class="in">`pyglet`</span> developed for this project, it can be found in the <span class="co">[</span><span class="ot">GitHub repository</span><span class="co">]</span>((https://github.com/zeemarquez/FEM)). Finally, <span class="in">`gmsh`</span> is a powerful mesh generation software that can be used in conjunction with <span class="in">`pygmsh`</span>. Together, these libraries provide the tools necessary to implement the finite element method in Python.</span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> math <span class="im">import</span> <span class="op">*</span></span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> drawMesh</span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pygmsh</span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> gmsh</span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a><span class="fu"># Mesh</span></span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>The separation of the geometry into elements and nodes can be done manually but it becomes exponetially difficult for complex geometries and finer mesh resolutions. Therefore we make use of <span class="in">`gmsh`</span>, a powerful meshing tool.</span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>We create the mesh using <span class="in">`pygmsh`</span>. The mesh resolution is defined in the variable <span class="in">`resolution`</span>. The lower the value of <span class="in">`resolution`</span>, the more the mesh will be divided into elements. This will lead to better results but higher computational cost. On of the key aspects of FEM is to balance between mesh resolution and computing power. </span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>gmsh.initialize()</span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>rect_width, rect_length  <span class="op">=</span> <span class="fl">3.0</span>, <span class="fl">10.0</span></span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a>resolution <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a>geom <span class="op">=</span> pygmsh.geo.Geometry()</span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>circle <span class="op">=</span> geom.add_circle(</span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">5</span>,<span class="fl">1.5</span>,<span class="dv">0</span>],</span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a>    radius<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a>    mesh_size<span class="op">=</span>resolution<span class="op">*</span><span class="fl">0.5</span>,</span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>    make_surface<span class="op">=</span><span class="va">False</span></span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a>rect <span class="op">=</span> geom.add_polygon(</span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">0.0</span>, <span class="fl">0.0</span>                ,<span class="dv">0</span>],</span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">0.0</span>, rect_width         ,<span class="dv">0</span>],</span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>        [rect_length, rect_width ,<span class="dv">0</span>],</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a>        [rect_length, <span class="fl">0.0</span>        ,<span class="dv">0</span>],</span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>    mesh_size<span class="op">=</span>resolution , holes <span class="op">=</span> [circle]</span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>mesh <span class="op">=</span> geom.generate_mesh(dim<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a>geom.<span class="fu">__exit__</span>()</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-114"><a href="#cb25-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-115"><a href="#cb25-115" aria-hidden="true" tabindex="-1"></a>The resultant mesh looks like this:</span>
<span id="cb25-116"><a href="#cb25-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-117"><a href="#cb25-117" aria-hidden="true" tabindex="-1"></a><span class="al">![](pictures/mesh.png)</span>{width=75% fig-align="center"}</span>
<span id="cb25-118"><a href="#cb25-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-119"><a href="#cb25-119" aria-hidden="true" tabindex="-1"></a>This mesh is composed of many nodes, that form triangular elements. Many nodes are shared by different by multiple elements. </span>
<span id="cb25-120"><a href="#cb25-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-121"><a href="#cb25-121" aria-hidden="true" tabindex="-1"></a><span class="fu">## Node</span></span>
<span id="cb25-122"><a href="#cb25-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-123"><a href="#cb25-123" aria-hidden="true" tabindex="-1"></a>The following code defines the <span class="in">`Node`</span> class, which represents a node in a mesh. The class has several attributes and methods that are used to store and manipulate information about the node, such as its coordinates, forces, and displacements. </span>
<span id="cb25-124"><a href="#cb25-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-125"><a href="#cb25-125" aria-hidden="true" tabindex="-1"></a><span class="al">![](pictures/node_element.png)</span>{width=75% fig-align="center"}</span>
<span id="cb25-126"><a href="#cb25-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-127"><a href="#cb25-127" aria-hidden="true" tabindex="-1"></a>The init method is used to initialize a new Node object, and accepts the node's id, x and y coordinates as arguments. The fx and fy attributes are used to store the external forces applied to the node, and the rx and ry attributes are used to store the reaction forces at the node. The dx and dy attributes are used to store the displacements of the node.</span>
<span id="cb25-128"><a href="#cb25-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-129"><a href="#cb25-129" aria-hidden="true" tabindex="-1"></a>The dfix property returns a Boolean value indicating whether the node is fixed in both x and y directions. The externalForce property returns a Boolean value indicating whether the node has any external forces applied to it. The eq method is used to compare two Node objects and returns a Boolean value indicating whether they are at the same location. This class can be used to represent nodes in a mesh and perform operations on them.</span>
<span id="cb25-130"><a href="#cb25-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-133"><a href="#cb25-133" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-134"><a href="#cb25-134" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Node:</span>
<span id="cb25-135"><a href="#cb25-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-136"><a href="#cb25-136" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, <span class="bu">id</span>, x, y):</span>
<span id="cb25-137"><a href="#cb25-137" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb25-138"><a href="#cb25-138" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x, <span class="va">self</span>.y <span class="op">=</span> x, y</span>
<span id="cb25-139"><a href="#cb25-139" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fx, <span class="va">self</span>.fy <span class="op">=</span> <span class="fl">0.0</span>, <span class="fl">0.0</span></span>
<span id="cb25-140"><a href="#cb25-140" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.rx, <span class="va">self</span>.ry <span class="op">=</span> <span class="fl">0.0</span> ,<span class="fl">0.0</span></span>
<span id="cb25-141"><a href="#cb25-141" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.dx, <span class="va">self</span>.dy <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span></span>
<span id="cb25-142"><a href="#cb25-142" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-143"><a href="#cb25-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb25-144"><a href="#cb25-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> dfix(<span class="va">self</span>):</span>
<span id="cb25-145"><a href="#cb25-145" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.dx <span class="op">==</span> <span class="fl">0.0</span> <span class="kw">and</span> <span class="va">self</span>.dy <span class="op">==</span> <span class="fl">0.0</span>:</span>
<span id="cb25-146"><a href="#cb25-146" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb25-147"><a href="#cb25-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb25-148"><a href="#cb25-148" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb25-149"><a href="#cb25-149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-150"><a href="#cb25-150" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb25-151"><a href="#cb25-151" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> externalForce(<span class="va">self</span>):</span>
<span id="cb25-152"><a href="#cb25-152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.fx <span class="op">!=</span> <span class="fl">0.0</span> <span class="kw">or</span> <span class="va">self</span>.fy <span class="op">!=</span> <span class="fl">0.0</span>:</span>
<span id="cb25-153"><a href="#cb25-153" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb25-154"><a href="#cb25-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb25-155"><a href="#cb25-155" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb25-156"><a href="#cb25-156" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-157"><a href="#cb25-157" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__eq__</span>(<span class="va">self</span>, obj):</span>
<span id="cb25-158"><a href="#cb25-158" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="va">self</span>.x <span class="op">==</span> obj.x) <span class="kw">and</span> (<span class="va">self</span>.y <span class="op">==</span> obj.y):</span>
<span id="cb25-159"><a href="#cb25-159" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb25-160"><a href="#cb25-160" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb25-161"><a href="#cb25-161" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">False</span>       </span>
<span id="cb25-162"><a href="#cb25-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-163"><a href="#cb25-163" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-164"><a href="#cb25-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-165"><a href="#cb25-165" aria-hidden="true" tabindex="-1"></a><span class="fu">## Element</span></span>
<span id="cb25-166"><a href="#cb25-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-167"><a href="#cb25-167" aria-hidden="true" tabindex="-1"></a>Each element contains a series of nodes. In this case, we are using triangular nodes therefore each element has three nodes. It is important for the calculations that the nodes in each element are ordered counter-clockwise, therefore the passed nodes in the initialization are ordered with the <span class="in">`orderCounterClock()`</span> method. Each element contains a <span class="in">`stress`</span> ($\vec{\sigma}$) and a <span class="in">`strain`</span> ($\vec{\varepsilon}$) attributes:</span>
<span id="cb25-168"><a href="#cb25-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-169"><a href="#cb25-169" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb25-170"><a href="#cb25-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-171"><a href="#cb25-171" aria-hidden="true" tabindex="-1"></a>\vec{\sigma} =  \begin{bmatrix}</span>
<span id="cb25-172"><a href="#cb25-172" aria-hidden="true" tabindex="-1"></a>\sigma_{xx}<span class="sc">\\</span></span>
<span id="cb25-173"><a href="#cb25-173" aria-hidden="true" tabindex="-1"></a>\sigma_{yy}<span class="sc">\\</span></span>
<span id="cb25-174"><a href="#cb25-174" aria-hidden="true" tabindex="-1"></a>\sigma_{xy}<span class="sc">\\</span></span>
<span id="cb25-175"><a href="#cb25-175" aria-hidden="true" tabindex="-1"></a>\end{bmatrix} </span>
<span id="cb25-176"><a href="#cb25-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-177"><a href="#cb25-177" aria-hidden="true" tabindex="-1"></a>\hspace{10mm}</span>
<span id="cb25-178"><a href="#cb25-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-179"><a href="#cb25-179" aria-hidden="true" tabindex="-1"></a> \vec{\varepsilon} =  \begin{bmatrix}</span>
<span id="cb25-180"><a href="#cb25-180" aria-hidden="true" tabindex="-1"></a>\varepsilon_{xx}<span class="sc">\\</span></span>
<span id="cb25-181"><a href="#cb25-181" aria-hidden="true" tabindex="-1"></a>\varepsilon_{yy}<span class="sc">\\</span></span>
<span id="cb25-182"><a href="#cb25-182" aria-hidden="true" tabindex="-1"></a>\gamma_{xy}<span class="sc">\\</span></span>
<span id="cb25-183"><a href="#cb25-183" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb25-184"><a href="#cb25-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-185"><a href="#cb25-185" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb25-186"><a href="#cb25-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-187"><a href="#cb25-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-188"><a href="#cb25-188" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb25-189"><a href="#cb25-189" aria-hidden="true" tabindex="-1"></a> \mathbf{d^e} =  \begin{bmatrix}</span>
<span id="cb25-190"><a href="#cb25-190" aria-hidden="true" tabindex="-1"></a>d_{0,x}^e<span class="sc">\\</span></span>
<span id="cb25-191"><a href="#cb25-191" aria-hidden="true" tabindex="-1"></a>d_{0,y}^e<span class="sc">\\</span></span>
<span id="cb25-192"><a href="#cb25-192" aria-hidden="true" tabindex="-1"></a>d_{1,x}^e<span class="sc">\\</span></span>
<span id="cb25-193"><a href="#cb25-193" aria-hidden="true" tabindex="-1"></a>d_{1,y}^e<span class="sc">\\</span></span>
<span id="cb25-194"><a href="#cb25-194" aria-hidden="true" tabindex="-1"></a>d_{2,x}^e<span class="sc">\\</span></span>
<span id="cb25-195"><a href="#cb25-195" aria-hidden="true" tabindex="-1"></a>d_{2,y}^e<span class="sc">\\</span></span>
<span id="cb25-196"><a href="#cb25-196" aria-hidden="true" tabindex="-1"></a>\end{bmatrix} </span>
<span id="cb25-197"><a href="#cb25-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-198"><a href="#cb25-198" aria-hidden="true" tabindex="-1"></a>\hspace{5mm}</span>
<span id="cb25-199"><a href="#cb25-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-200"><a href="#cb25-200" aria-hidden="true" tabindex="-1"></a>\mathbf{K^e} = \begin{bmatrix}</span>
<span id="cb25-201"><a href="#cb25-201" aria-hidden="true" tabindex="-1"></a>k_{00} &amp; k_{01} &amp; k_{02} &amp; k_{03} &amp; k_{04} &amp; k_{05} &amp; <span class="sc">\\</span> </span>
<span id="cb25-202"><a href="#cb25-202" aria-hidden="true" tabindex="-1"></a>k_{10} &amp; k_{11} &amp; k_{12} &amp; k_{13} &amp; k_{14} &amp; k_{15} &amp; <span class="sc">\\</span> </span>
<span id="cb25-203"><a href="#cb25-203" aria-hidden="true" tabindex="-1"></a>k_{20} &amp; k_{21} &amp; k_{22} &amp; k_{23} &amp; k_{24} &amp; k_{25} &amp; <span class="sc">\\</span> </span>
<span id="cb25-204"><a href="#cb25-204" aria-hidden="true" tabindex="-1"></a>k_{30} &amp; k_{31} &amp; k_{32} &amp; k_{33} &amp; k_{34} &amp; k_{35} &amp; <span class="sc">\\</span> </span>
<span id="cb25-205"><a href="#cb25-205" aria-hidden="true" tabindex="-1"></a>k_{40} &amp; k_{41} &amp; k_{42} &amp; k_{43} &amp; k_{44} &amp; k_{45} &amp; <span class="sc">\\</span> </span>
<span id="cb25-206"><a href="#cb25-206" aria-hidden="true" tabindex="-1"></a>k_{50} &amp; k_{51} &amp; k_{52} &amp; k_{53} &amp; k_{54} &amp; k_{55} &amp; <span class="sc">\\</span> </span>
<span id="cb25-207"><a href="#cb25-207" aria-hidden="true" tabindex="-1"></a>\end{bmatrix}</span>
<span id="cb25-208"><a href="#cb25-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-209"><a href="#cb25-209" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb25-210"><a href="#cb25-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-211"><a href="#cb25-211" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb25-212"><a href="#cb25-212" aria-hidden="true" tabindex="-1"></a>\mathbf{K^e} = \int_{\Omega}(\mathbf{B^e})^T \mathbf{D} \hspace{1mm} \mathbf{B^e} d \Omega = (\mathbf{B^e})^T \mathbf{D} \hspace{1mm} \mathbf{B^e}</span>
<span id="cb25-213"><a href="#cb25-213" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb25-214"><a href="#cb25-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-215"><a href="#cb25-215" aria-hidden="true" tabindex="-1"></a>\begin{equation}</span>
<span id="cb25-216"><a href="#cb25-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-217"><a href="#cb25-217" aria-hidden="true" tabindex="-1"></a> \mathbf{B^e} =  \frac{1}{2 A^e} \begin{bmatrix}</span>
<span id="cb25-218"><a href="#cb25-218" aria-hidden="true" tabindex="-1"></a>(y_1^e - y_2^e) &amp; 0 &amp; (y_2^e - y_0^e) &amp; 0 &amp; (y_0^e - y_1^e) &amp; 0 &amp; <span class="sc">\\</span></span>
<span id="cb25-219"><a href="#cb25-219" aria-hidden="true" tabindex="-1"></a>0 &amp; (x_2^e - x_1^e) &amp; 0 &amp; (x_0^e - x_2^e) &amp; 0 &amp; (x_1^e - x_0^e) &amp; <span class="sc">\\</span></span>
<span id="cb25-220"><a href="#cb25-220" aria-hidden="true" tabindex="-1"></a>(x_2^e - x_1^e) &amp; (y_1^e - y_2^e) &amp; (x_0^e - x_2^e) &amp; (y_2^e - y_0^e) &amp; (x_1^e - x_0^e) &amp; (y_0^e - y_1^e) &amp; <span class="sc">\\</span></span>
<span id="cb25-221"><a href="#cb25-221" aria-hidden="true" tabindex="-1"></a>\end{bmatrix} </span>
<span id="cb25-222"><a href="#cb25-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-223"><a href="#cb25-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-224"><a href="#cb25-224" aria-hidden="true" tabindex="-1"></a>\end{equation}</span>
<span id="cb25-225"><a href="#cb25-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-228"><a href="#cb25-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-229"><a href="#cb25-229" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Element:</span>
<span id="cb25-230"><a href="#cb25-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-231"><a href="#cb25-231" aria-hidden="true" tabindex="-1"></a>    maxColorVal <span class="op">=</span> <span class="op">-</span><span class="fl">9.9e19</span></span>
<span id="cb25-232"><a href="#cb25-232" aria-hidden="true" tabindex="-1"></a>    minColorVal <span class="op">=</span> <span class="fl">9.9e19</span></span>
<span id="cb25-233"><a href="#cb25-233" aria-hidden="true" tabindex="-1"></a>    colorFunc <span class="op">=</span> <span class="kw">lambda</span> x: x</span>
<span id="cb25-234"><a href="#cb25-234" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-235"><a href="#cb25-235" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, <span class="bu">id</span>, nodes):</span>
<span id="cb25-236"><a href="#cb25-236" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.<span class="bu">id</span> <span class="op">=</span> <span class="bu">id</span></span>
<span id="cb25-237"><a href="#cb25-237" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.nodes <span class="op">=</span> <span class="va">self</span>.orderCounterClock(nodes)</span>
<span id="cb25-238"><a href="#cb25-238" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.stress <span class="op">=</span> <span class="va">None</span></span>
<span id="cb25-239"><a href="#cb25-239" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.strain <span class="op">=</span> <span class="va">None</span></span>
<span id="cb25-240"><a href="#cb25-240" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.colorVal <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-241"><a href="#cb25-241" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.getArea()</span>
<span id="cb25-242"><a href="#cb25-242" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-243"><a href="#cb25-243" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb25-244"><a href="#cb25-244" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getmaxColorVal(<span class="va">self</span>):</span>
<span id="cb25-245"><a href="#cb25-245" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Element.maxColorVal</span>
<span id="cb25-246"><a href="#cb25-246" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-247"><a href="#cb25-247" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb25-248"><a href="#cb25-248" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getminColorVal(<span class="va">self</span>):</span>
<span id="cb25-249"><a href="#cb25-249" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Element.minColorVal</span>
<span id="cb25-250"><a href="#cb25-250" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-251"><a href="#cb25-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">@property</span></span>
<span id="cb25-252"><a href="#cb25-252" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getcolorFunc(<span class="va">self</span>):</span>
<span id="cb25-253"><a href="#cb25-253" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Element.colorFunc</span>
<span id="cb25-254"><a href="#cb25-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-255"><a href="#cb25-255" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getde(<span class="va">self</span>):</span>
<span id="cb25-256"><a href="#cb25-256" aria-hidden="true" tabindex="-1"></a>        de_ <span class="op">=</span> []</span>
<span id="cb25-257"><a href="#cb25-257" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n <span class="kw">in</span> <span class="va">self</span>.nodes:</span>
<span id="cb25-258"><a href="#cb25-258" aria-hidden="true" tabindex="-1"></a>            de_.append(n.dx)</span>
<span id="cb25-259"><a href="#cb25-259" aria-hidden="true" tabindex="-1"></a>            de_.append(n.dy)</span>
<span id="cb25-260"><a href="#cb25-260" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.de <span class="op">=</span> np.array(de_)</span>
<span id="cb25-261"><a href="#cb25-261" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>.de</span>
<span id="cb25-262"><a href="#cb25-262" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-263"><a href="#cb25-263" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getColor(<span class="va">self</span>):</span>
<span id="cb25-264"><a href="#cb25-264" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-265"><a href="#cb25-265" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>: x_ <span class="op">=</span> <span class="bu">float</span>(<span class="va">self</span>.colorVal <span class="op">-</span> Element.minColorVal)<span class="op">/</span>(Element.maxColorVal <span class="op">-</span> Element.minColorVal)</span>
<span id="cb25-266"><a href="#cb25-266" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ZeroDivisionError</span>: x_ <span class="op">=</span> <span class="fl">0.5</span> <span class="co"># cmax == cmin</span></span>
<span id="cb25-267"><a href="#cb25-267" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-268"><a href="#cb25-268" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> Element.colorFunc(x_)</span>
<span id="cb25-269"><a href="#cb25-269" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-270"><a href="#cb25-270" aria-hidden="true" tabindex="-1"></a>        blue  <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>(<span class="fl">0.75</span><span class="op">-</span>x), <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb25-271"><a href="#cb25-271" aria-hidden="true" tabindex="-1"></a>        red   <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>(x<span class="op">-</span><span class="fl">0.25</span>), <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb25-272"><a href="#cb25-272" aria-hidden="true" tabindex="-1"></a>        green <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>fabs(x<span class="op">-</span><span class="fl">0.5</span>)<span class="op">-</span><span class="fl">1.</span>, <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb25-273"><a href="#cb25-273" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (red, green, blue)</span>
<span id="cb25-274"><a href="#cb25-274" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-275"><a href="#cb25-275" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getArea(<span class="va">self</span>):</span>
<span id="cb25-276"><a href="#cb25-276" aria-hidden="true" tabindex="-1"></a>        x1,y1 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">0</span>].x, <span class="va">self</span>.nodes[<span class="dv">0</span>].y</span>
<span id="cb25-277"><a href="#cb25-277" aria-hidden="true" tabindex="-1"></a>        x2,y2 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">1</span>].x, <span class="va">self</span>.nodes[<span class="dv">1</span>].y</span>
<span id="cb25-278"><a href="#cb25-278" aria-hidden="true" tabindex="-1"></a>        x3,y3 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">2</span>].x, <span class="va">self</span>.nodes[<span class="dv">2</span>].y</span>
<span id="cb25-279"><a href="#cb25-279" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> <span class="fl">0.5</span><span class="op">*</span>((x2<span class="op">*</span>y3 <span class="op">-</span> x3<span class="op">*</span>y2)<span class="op">-</span>(x1<span class="op">*</span>y3<span class="op">-</span> x3<span class="op">*</span>y1)<span class="op">+</span>(x1<span class="op">*</span>y2<span class="op">-</span>x2<span class="op">*</span>y1))</span>
<span id="cb25-280"><a href="#cb25-280" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> result <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb25-281"><a href="#cb25-281" aria-hidden="true" tabindex="-1"></a>            result <span class="op">=</span> <span class="fl">1e-20</span></span>
<span id="cb25-282"><a href="#cb25-282" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.area <span class="op">=</span> result</span>
<span id="cb25-283"><a href="#cb25-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb25-284"><a href="#cb25-284" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-285"><a href="#cb25-285" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getBe(<span class="va">self</span>):</span>
<span id="cb25-286"><a href="#cb25-286" aria-hidden="true" tabindex="-1"></a>        x1,y1 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">0</span>].x, <span class="va">self</span>.nodes[<span class="dv">0</span>].y</span>
<span id="cb25-287"><a href="#cb25-287" aria-hidden="true" tabindex="-1"></a>        x2,y2 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">1</span>].x, <span class="va">self</span>.nodes[<span class="dv">1</span>].y</span>
<span id="cb25-288"><a href="#cb25-288" aria-hidden="true" tabindex="-1"></a>        x3,y3 <span class="op">=</span> <span class="va">self</span>.nodes[<span class="dv">2</span>].x, <span class="va">self</span>.nodes[<span class="dv">2</span>].y</span>
<span id="cb25-289"><a href="#cb25-289" aria-hidden="true" tabindex="-1"></a>        B <span class="op">=</span> (<span class="fl">0.5</span><span class="op">/</span><span class="va">self</span>.area) <span class="op">*</span> np.array([</span>
<span id="cb25-290"><a href="#cb25-290" aria-hidden="true" tabindex="-1"></a>            [(y2<span class="op">-</span>y3) ,  <span class="dv">0</span>    , (y3<span class="op">-</span>y1),  <span class="dv">0</span>   ,   (y1<span class="op">-</span>y2),   <span class="dv">0</span>   ],</span>
<span id="cb25-291"><a href="#cb25-291" aria-hidden="true" tabindex="-1"></a>            [   <span class="dv">0</span>    , (x3<span class="op">-</span>x2),  <span class="dv">0</span>    , (x1<span class="op">-</span>x3),     <span class="dv">0</span>   ,(x2<span class="op">-</span>x1)],</span>
<span id="cb25-292"><a href="#cb25-292" aria-hidden="true" tabindex="-1"></a>            [(x3<span class="op">-</span>x2) , (y2<span class="op">-</span>y3), (x1<span class="op">-</span>x3), (y3<span class="op">-</span>y1), (x2<span class="op">-</span>x1) ,(y1<span class="op">-</span>y2)],</span>
<span id="cb25-293"><a href="#cb25-293" aria-hidden="true" tabindex="-1"></a>        ], dtype<span class="op">=</span>np.float64)</span>
<span id="cb25-294"><a href="#cb25-294" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Be <span class="op">=</span> B</span>
<span id="cb25-295"><a href="#cb25-295" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> B</span>
<span id="cb25-296"><a href="#cb25-296" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-297"><a href="#cb25-297" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getKe(<span class="va">self</span>, D):</span>
<span id="cb25-298"><a href="#cb25-298" aria-hidden="true" tabindex="-1"></a>        Bie <span class="op">=</span> <span class="va">self</span>.getBe()</span>
<span id="cb25-299"><a href="#cb25-299" aria-hidden="true" tabindex="-1"></a>        Ke <span class="op">=</span> <span class="va">self</span>.area<span class="op">*</span> np.matmul(Bie.T, np.matmul(D, Bie))</span>
<span id="cb25-300"><a href="#cb25-300" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.Ke <span class="op">=</span> Ke</span>
<span id="cb25-301"><a href="#cb25-301" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Ke</span>
<span id="cb25-302"><a href="#cb25-302" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-303"><a href="#cb25-303" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> orderCounterClock(<span class="va">self</span>, nodes):</span>
<span id="cb25-304"><a href="#cb25-304" aria-hidden="true" tabindex="-1"></a>        p1,p2,p3 <span class="op">=</span> nodes[<span class="dv">0</span>], nodes[<span class="dv">1</span>], nodes[<span class="dv">2</span>]</span>
<span id="cb25-305"><a href="#cb25-305" aria-hidden="true" tabindex="-1"></a>        val <span class="op">=</span> (p2.y <span class="op">-</span> p1.y) <span class="op">*</span> (p3.x <span class="op">-</span> p2.x) <span class="op">-</span> (p2.x <span class="op">-</span> p1.x) <span class="op">*</span> (p3.y <span class="op">-</span> p2.y)</span>
<span id="cb25-306"><a href="#cb25-306" aria-hidden="true" tabindex="-1"></a>        nodes_ <span class="op">=</span> nodes.copy()</span>
<span id="cb25-307"><a href="#cb25-307" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> val <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb25-308"><a href="#cb25-308" aria-hidden="true" tabindex="-1"></a>            nodes[<span class="dv">1</span>] <span class="op">=</span> nodes_[<span class="dv">0</span>]</span>
<span id="cb25-309"><a href="#cb25-309" aria-hidden="true" tabindex="-1"></a>            nodes[<span class="dv">0</span>] <span class="op">=</span> nodes_[<span class="dv">1</span>]   </span>
<span id="cb25-310"><a href="#cb25-310" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-311"><a href="#cb25-311" aria-hidden="true" tabindex="-1"></a>        assembly <span class="op">=</span> []</span>
<span id="cb25-312"><a href="#cb25-312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> n <span class="kw">in</span> nodes:</span>
<span id="cb25-313"><a href="#cb25-313" aria-hidden="true" tabindex="-1"></a>            assembly.append(<span class="bu">int</span>(n.<span class="bu">id</span><span class="op">*</span><span class="dv">2</span>))</span>
<span id="cb25-314"><a href="#cb25-314" aria-hidden="true" tabindex="-1"></a>            assembly.append(<span class="bu">int</span>(n.<span class="bu">id</span><span class="op">*</span><span class="dv">2</span>) <span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb25-315"><a href="#cb25-315" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.assembly <span class="op">=</span> assembly</span>
<span id="cb25-316"><a href="#cb25-316" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-317"><a href="#cb25-317" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> nodes    </span>
<span id="cb25-318"><a href="#cb25-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-319"><a href="#cb25-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-320"><a href="#cb25-320" aria-hidden="true" tabindex="-1"></a><span class="fu"># Preprocessing</span></span>
<span id="cb25-321"><a href="#cb25-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-322"><a href="#cb25-322" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extract mesh data</span></span>
<span id="cb25-323"><a href="#cb25-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-326"><a href="#cb25-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-327"><a href="#cb25-327" aria-hidden="true" tabindex="-1"></a>maxNode <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb25-328"><a href="#cb25-328" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cell <span class="kw">in</span> mesh.cells[<span class="dv">1</span>].data:</span>
<span id="cb25-329"><a href="#cb25-329" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> node <span class="kw">in</span> cell:</span>
<span id="cb25-330"><a href="#cb25-330" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> node <span class="op">&gt;</span> maxNode:</span>
<span id="cb25-331"><a href="#cb25-331" aria-hidden="true" tabindex="-1"></a>            maxNode <span class="op">=</span> node</span>
<span id="cb25-332"><a href="#cb25-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-333"><a href="#cb25-333" aria-hidden="true" tabindex="-1"></a>meshCells <span class="op">=</span> mesh.cells[<span class="dv">1</span>].data <span class="op">-</span> np.full(np.shape(mesh.cells[<span class="dv">1</span>].data), <span class="dv">1</span>, dtype<span class="op">=</span>np.uint64)</span>
<span id="cb25-334"><a href="#cb25-334" aria-hidden="true" tabindex="-1"></a>meshPoints <span class="op">=</span> mesh.points[<span class="dv">1</span>:]</span>
<span id="cb25-335"><a href="#cb25-335" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-336"><a href="#cb25-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-339"><a href="#cb25-339" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-340"><a href="#cb25-340" aria-hidden="true" tabindex="-1"></a>nodes <span class="op">=</span> [Node(i, point[<span class="dv">0</span>], point[<span class="dv">1</span>]) <span class="cf">for</span> i, point <span class="kw">in</span> <span class="bu">enumerate</span>(meshPoints)]</span>
<span id="cb25-341"><a href="#cb25-341" aria-hidden="true" tabindex="-1"></a>elements <span class="op">=</span> []</span>
<span id="cb25-342"><a href="#cb25-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-343"><a href="#cb25-343" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,cell <span class="kw">in</span> <span class="bu">enumerate</span>(meshCells):</span>
<span id="cb25-344"><a href="#cb25-344" aria-hidden="true" tabindex="-1"></a>    elements.append(</span>
<span id="cb25-345"><a href="#cb25-345" aria-hidden="true" tabindex="-1"></a>        Element(<span class="bu">id</span><span class="op">=</span>i, nodes<span class="op">=</span>[nodes[i] <span class="cf">for</span> i <span class="kw">in</span> cell])</span>
<span id="cb25-346"><a href="#cb25-346" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-347"><a href="#cb25-347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-348"><a href="#cb25-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-349"><a href="#cb25-349" aria-hidden="true" tabindex="-1"></a><span class="fu">## Material properties</span></span>
<span id="cb25-350"><a href="#cb25-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-353"><a href="#cb25-353" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-354"><a href="#cb25-354" aria-hidden="true" tabindex="-1"></a>v <span class="op">=</span> <span class="fl">0.28</span></span>
<span id="cb25-355"><a href="#cb25-355" aria-hidden="true" tabindex="-1"></a>E <span class="op">=</span> <span class="fl">200.0e9</span></span>
<span id="cb25-356"><a href="#cb25-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-357"><a href="#cb25-357" aria-hidden="true" tabindex="-1"></a>D <span class="op">=</span> (E<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>v<span class="op">**</span><span class="dv">2</span>)) <span class="op">*</span> np.array([</span>
<span id="cb25-358"><a href="#cb25-358" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, v, <span class="dv">0</span>],</span>
<span id="cb25-359"><a href="#cb25-359" aria-hidden="true" tabindex="-1"></a>    [v, <span class="dv">1</span>, <span class="dv">0</span>],</span>
<span id="cb25-360"><a href="#cb25-360" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="dv">0</span>, (<span class="dv">1</span><span class="op">-</span>v)<span class="op">/</span><span class="dv">2</span>],</span>
<span id="cb25-361"><a href="#cb25-361" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb25-362"><a href="#cb25-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-363"><a href="#cb25-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-364"><a href="#cb25-364" aria-hidden="true" tabindex="-1"></a><span class="fu">## Boundary conditions and forces</span></span>
<span id="cb25-365"><a href="#cb25-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-368"><a href="#cb25-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-369"><a href="#cb25-369" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, node <span class="kw">in</span> <span class="bu">enumerate</span>(nodes):</span>
<span id="cb25-370"><a href="#cb25-370" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node.x <span class="op">==</span> rect_length:           <span class="co"># At right side of the rectangle (x=10)</span></span>
<span id="cb25-371"><a href="#cb25-371" aria-hidden="true" tabindex="-1"></a>        node.fx <span class="op">=</span> <span class="fl">1.0e3</span>                 <span class="co"># Apply a downwards force of 1kN</span></span>
<span id="cb25-372"><a href="#cb25-372" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> node.x <span class="op">==</span> <span class="fl">0.0</span>:                 <span class="co"># At left side of the rectangle (x=0)</span></span>
<span id="cb25-373"><a href="#cb25-373" aria-hidden="true" tabindex="-1"></a>        node.dx, node.dy <span class="op">=</span> <span class="fl">0.0</span>, <span class="fl">0.0</span>     <span class="co"># Fix the displacement in x and y</span></span>
<span id="cb25-374"><a href="#cb25-374" aria-hidden="true" tabindex="-1"></a>        node.rx, node.ry <span class="op">=</span> <span class="va">None</span>, <span class="va">None</span>   <span class="co"># Set the reaction forces as unknowns</span></span>
<span id="cb25-375"><a href="#cb25-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-376"><a href="#cb25-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-377"><a href="#cb25-377" aria-hidden="true" tabindex="-1"></a><span class="fu"># Stiffness matrix assembly</span></span>
<span id="cb25-378"><a href="#cb25-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-379"><a href="#cb25-379" aria-hidden="true" tabindex="-1"></a><span class="al">![](pictures/node_assembly.png)</span>{width=75% fig-align="center"}</span>
<span id="cb25-380"><a href="#cb25-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-383"><a href="#cb25-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-384"><a href="#cb25-384" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> assemblyK(K, Ke, nodeAssembly):</span>
<span id="cb25-385"><a href="#cb25-385" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i,t <span class="kw">in</span> <span class="bu">enumerate</span>(nodeAssembly):</span>
<span id="cb25-386"><a href="#cb25-386" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j,s <span class="kw">in</span> <span class="bu">enumerate</span>(nodeAssembly):</span>
<span id="cb25-387"><a href="#cb25-387" aria-hidden="true" tabindex="-1"></a>            K[t][s] <span class="op">+=</span> Ke[i][j]</span>
<span id="cb25-388"><a href="#cb25-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-389"><a href="#cb25-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-390"><a href="#cb25-390" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-391"><a href="#cb25-391" aria-hidden="true" tabindex="-1"></a>\mathbf{K} = \sum_{i = 0}^{N_{el}} \mathbf{\hat{K}^e}</span>
<span id="cb25-392"><a href="#cb25-392" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-393"><a href="#cb25-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-396"><a href="#cb25-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-397"><a href="#cb25-397" aria-hidden="true" tabindex="-1"></a>Nnodes <span class="op">=</span> <span class="bu">len</span>(nodes)</span>
<span id="cb25-398"><a href="#cb25-398" aria-hidden="true" tabindex="-1"></a>K <span class="op">=</span> np.zeros((Nnodes<span class="op">*</span><span class="dv">2</span>,Nnodes<span class="op">*</span><span class="dv">2</span>))</span>
<span id="cb25-399"><a href="#cb25-399" aria-hidden="true" tabindex="-1"></a>B_list <span class="op">=</span> []</span>
<span id="cb25-400"><a href="#cb25-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-401"><a href="#cb25-401" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> e <span class="kw">in</span> elements:</span>
<span id="cb25-402"><a href="#cb25-402" aria-hidden="true" tabindex="-1"></a>    Ke <span class="op">=</span> e.getKe(D)</span>
<span id="cb25-403"><a href="#cb25-403" aria-hidden="true" tabindex="-1"></a>    nodeAssembly <span class="op">=</span> e.assembly</span>
<span id="cb25-404"><a href="#cb25-404" aria-hidden="true" tabindex="-1"></a>    assemblyK(K, Ke, nodeAssembly)</span>
<span id="cb25-405"><a href="#cb25-405" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-406"><a href="#cb25-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-407"><a href="#cb25-407" aria-hidden="true" tabindex="-1"></a>$$Kd = f + r$$</span>
<span id="cb25-408"><a href="#cb25-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-411"><a href="#cb25-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-412"><a href="#cb25-412" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> np.zeros((<span class="bu">int</span>(<span class="dv">2</span><span class="op">*</span>Nnodes), <span class="dv">1</span>))</span>
<span id="cb25-413"><a href="#cb25-413" aria-hidden="true" tabindex="-1"></a>d <span class="op">=</span> np.full((<span class="bu">int</span>(<span class="dv">2</span><span class="op">*</span>Nnodes), <span class="dv">1</span>), <span class="va">None</span>)</span>
<span id="cb25-414"><a href="#cb25-414" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> np.full((<span class="bu">int</span>(<span class="dv">2</span><span class="op">*</span>Nnodes), <span class="dv">1</span>), <span class="va">None</span>)</span>
<span id="cb25-415"><a href="#cb25-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-416"><a href="#cb25-416" aria-hidden="true" tabindex="-1"></a>rowsrk, rowsdk <span class="op">=</span> [], []</span>
<span id="cb25-417"><a href="#cb25-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-418"><a href="#cb25-418" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,node <span class="kw">in</span> <span class="bu">enumerate</span>(nodes):</span>
<span id="cb25-419"><a href="#cb25-419" aria-hidden="true" tabindex="-1"></a>    ix,iy <span class="op">=</span> <span class="bu">int</span>(i<span class="op">*</span><span class="dv">2</span>), <span class="bu">int</span>(i<span class="op">*</span><span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb25-420"><a href="#cb25-420" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-421"><a href="#cb25-421" aria-hidden="true" tabindex="-1"></a>    f[ix], f[iy] <span class="op">=</span> node.fx, node.fy</span>
<span id="cb25-422"><a href="#cb25-422" aria-hidden="true" tabindex="-1"></a>    d[ix], d[iy] <span class="op">=</span> node.dx, node.dy</span>
<span id="cb25-423"><a href="#cb25-423" aria-hidden="true" tabindex="-1"></a>    r[ix], r[iy] <span class="op">=</span> node.rx, node.ry</span>
<span id="cb25-424"><a href="#cb25-424" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-425"><a href="#cb25-425" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node.dx <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb25-426"><a href="#cb25-426" aria-hidden="true" tabindex="-1"></a>        rowsrk.append(ix)</span>
<span id="cb25-427"><a href="#cb25-427" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-428"><a href="#cb25-428" aria-hidden="true" tabindex="-1"></a>        rowsdk.append(ix)</span>
<span id="cb25-429"><a href="#cb25-429" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb25-430"><a href="#cb25-430" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> node.dy <span class="op">==</span> <span class="va">None</span>:</span>
<span id="cb25-431"><a href="#cb25-431" aria-hidden="true" tabindex="-1"></a>        rowsrk.append(iy)</span>
<span id="cb25-432"><a href="#cb25-432" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb25-433"><a href="#cb25-433" aria-hidden="true" tabindex="-1"></a>        rowsdk.append(iy)</span>
<span id="cb25-434"><a href="#cb25-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-435"><a href="#cb25-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-436"><a href="#cb25-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-437"><a href="#cb25-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-438"><a href="#cb25-438" aria-hidden="true" tabindex="-1"></a><span class="fu"># Solver</span></span>
<span id="cb25-439"><a href="#cb25-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-442"><a href="#cb25-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-443"><a href="#cb25-443" aria-hidden="true" tabindex="-1"></a>KB <span class="op">=</span> np.zeros((<span class="bu">len</span>(rowsrk),<span class="bu">len</span>(rowsrk)))</span>
<span id="cb25-444"><a href="#cb25-444" aria-hidden="true" tabindex="-1"></a>KA <span class="op">=</span> np.zeros((<span class="bu">len</span>(rowsdk),<span class="bu">len</span>(rowsrk)))</span>
<span id="cb25-445"><a href="#cb25-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-446"><a href="#cb25-446" aria-hidden="true" tabindex="-1"></a>fk <span class="op">=</span> np.array([r[i] <span class="cf">for</span> i <span class="kw">in</span> rowsrk]) <span class="op">+</span> np.array([f[i] <span class="cf">for</span> i <span class="kw">in</span> rowsrk])</span>
<span id="cb25-447"><a href="#cb25-447" aria-hidden="true" tabindex="-1"></a>dk <span class="op">=</span> np.array([d[i] <span class="cf">for</span> i <span class="kw">in</span> rowsdk]) </span>
<span id="cb25-448"><a href="#cb25-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-449"><a href="#cb25-449" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(np.shape(KB)[<span class="dv">0</span>]):</span>
<span id="cb25-450"><a href="#cb25-450" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(np.shape(KB)[<span class="dv">1</span>]):</span>
<span id="cb25-451"><a href="#cb25-451" aria-hidden="true" tabindex="-1"></a>        KB[i][j] <span class="op">=</span> K [rowsrk[i]][rowsrk[j]]</span>
<span id="cb25-452"><a href="#cb25-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-453"><a href="#cb25-453" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(np.shape(KA)[<span class="dv">0</span>]):</span>
<span id="cb25-454"><a href="#cb25-454" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(np.shape(KA)[<span class="dv">1</span>]):</span>
<span id="cb25-455"><a href="#cb25-455" aria-hidden="true" tabindex="-1"></a>        KA[i][j] <span class="op">=</span> K [rowsdk[i]][rowsrk[j]]</span>
<span id="cb25-456"><a href="#cb25-456" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-457"><a href="#cb25-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-458"><a href="#cb25-458" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb25-459"><a href="#cb25-459" aria-hidden="true" tabindex="-1"></a>\mathbf{d_U} = \mathbf{K_B}^{-1} \mathbf{f_K} \hspace{10mm} \mathbf{f_U} = \mathbf{K_A} \mathbf{d_U}</span>
<span id="cb25-460"><a href="#cb25-460" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-463"><a href="#cb25-463" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-464"><a href="#cb25-464" aria-hidden="true" tabindex="-1"></a>du <span class="op">=</span> np.matmul(np.linalg.inv(KB), fk)</span>
<span id="cb25-465"><a href="#cb25-465" aria-hidden="true" tabindex="-1"></a>fu <span class="op">=</span> np.matmul(KA,du)</span>
<span id="cb25-466"><a href="#cb25-466" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-467"><a href="#cb25-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-468"><a href="#cb25-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-469"><a href="#cb25-469" aria-hidden="true" tabindex="-1"></a><span class="fu"># Postprocessing</span></span>
<span id="cb25-470"><a href="#cb25-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-473"><a href="#cb25-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-474"><a href="#cb25-474" aria-hidden="true" tabindex="-1"></a>d_total <span class="op">=</span> d.copy()</span>
<span id="cb25-475"><a href="#cb25-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-476"><a href="#cb25-476" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, d_solve <span class="kw">in</span> <span class="bu">zip</span>(rowsrk, du):</span>
<span id="cb25-477"><a href="#cb25-477" aria-hidden="true" tabindex="-1"></a>    d_total[i] <span class="op">=</span> d_solve</span>
<span id="cb25-478"><a href="#cb25-478" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-479"><a href="#cb25-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-480"><a href="#cb25-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-483"><a href="#cb25-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-484"><a href="#cb25-484" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,n <span class="kw">in</span> <span class="bu">enumerate</span>(nodes):</span>
<span id="cb25-485"><a href="#cb25-485" aria-hidden="true" tabindex="-1"></a>    ix,iy <span class="op">=</span> <span class="bu">int</span>(i<span class="op">*</span><span class="dv">2</span>), <span class="bu">int</span>(i<span class="op">*</span><span class="dv">2</span>)<span class="op">+</span><span class="dv">1</span></span>
<span id="cb25-486"><a href="#cb25-486" aria-hidden="true" tabindex="-1"></a>    n.dx <span class="op">=</span> d_total[ix][<span class="dv">0</span>]</span>
<span id="cb25-487"><a href="#cb25-487" aria-hidden="true" tabindex="-1"></a>    n.dy <span class="op">=</span> d_total[iy][<span class="dv">0</span>]</span>
<span id="cb25-488"><a href="#cb25-488" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-489"><a href="#cb25-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-490"><a href="#cb25-490" aria-hidden="true" tabindex="-1"></a><span class="fu">## Von-Mises Stress</span></span>
<span id="cb25-491"><a href="#cb25-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-492"><a href="#cb25-492" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-493"><a href="#cb25-493" aria-hidden="true" tabindex="-1"></a>\sigma_v = \sqrt{\sigma_{xx} + \sigma_{yy} + 3\sigma_{xy}^2 - \sigma_{xx}\sigma_{yy} }</span>
<span id="cb25-494"><a href="#cb25-494" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-495"><a href="#cb25-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-498"><a href="#cb25-498" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-499"><a href="#cb25-499" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculateVonMises(sx, sy, sxy):</span>
<span id="cb25-500"><a href="#cb25-500" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sqrt(sx<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> sy<span class="op">**</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>(sxy<span class="op">**</span><span class="dv">2</span>) <span class="op">-</span> sx<span class="op">*</span>sy)</span>
<span id="cb25-501"><a href="#cb25-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-502"><a href="#cb25-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-503"><a href="#cb25-503" aria-hidden="true" tabindex="-1"></a><span class="fu">## Mesh deformation and Coloring</span></span>
<span id="cb25-504"><a href="#cb25-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-507"><a href="#cb25-507" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-508"><a href="#cb25-508" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rgb(mag, cmin, cmax):</span>
<span id="cb25-509"><a href="#cb25-509" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>: x <span class="op">=</span> <span class="bu">float</span>(mag<span class="op">-</span>cmin)<span class="op">/</span>(cmax<span class="op">-</span>cmin)</span>
<span id="cb25-510"><a href="#cb25-510" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ZeroDivisionError</span>: x <span class="op">=</span> <span class="fl">0.5</span> </span>
<span id="cb25-511"><a href="#cb25-511" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-512"><a href="#cb25-512" aria-hidden="true" tabindex="-1"></a>    blue  <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>(<span class="fl">0.75</span><span class="op">-</span>x), <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb25-513"><a href="#cb25-513" aria-hidden="true" tabindex="-1"></a>    red   <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>(x<span class="op">-</span><span class="fl">0.25</span>), <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb25-514"><a href="#cb25-514" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> <span class="bu">int</span>(<span class="dv">255</span><span class="op">*</span> <span class="bu">min</span>((<span class="bu">max</span>((<span class="dv">4</span><span class="op">*</span>fabs(x<span class="op">-</span><span class="fl">0.5</span>)<span class="op">-</span><span class="fl">1.</span>, <span class="fl">0.</span>)), <span class="fl">1.</span>)))</span>
<span id="cb25-515"><a href="#cb25-515" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (red, green, blue)</span>
<span id="cb25-516"><a href="#cb25-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-517"><a href="#cb25-517" aria-hidden="true" tabindex="-1"></a>average <span class="op">=</span> <span class="kw">lambda</span> x: (<span class="bu">sum</span>(x)<span class="op">/</span><span class="bu">len</span>(x))</span>
<span id="cb25-518"><a href="#cb25-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-519"><a href="#cb25-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-522"><a href="#cb25-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-523"><a href="#cb25-523" aria-hidden="true" tabindex="-1"></a>maxd, mind <span class="op">=</span> <span class="bu">max</span>(d_total)[<span class="dv">0</span>], <span class="bu">min</span>(d_total)[<span class="dv">0</span>]</span>
<span id="cb25-524"><a href="#cb25-524" aria-hidden="true" tabindex="-1"></a>Element.colorFunc <span class="op">=</span> <span class="kw">lambda</span> x: x <span class="co">#exp(-x)</span></span>
<span id="cb25-525"><a href="#cb25-525" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-526"><a href="#cb25-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-527"><a href="#cb25-527" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-528"><a href="#cb25-528" aria-hidden="true" tabindex="-1"></a>\varepsilon^e = \mathbf{B}^e \mathbf{d}^e \hspace{20mm} \sigma^e = \mathbf{D} \varepsilon^e</span>
<span id="cb25-529"><a href="#cb25-529" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb25-530"><a href="#cb25-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-533"><a href="#cb25-533" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-534"><a href="#cb25-534" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i,element <span class="kw">in</span> <span class="bu">enumerate</span>(elements):</span>
<span id="cb25-535"><a href="#cb25-535" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-536"><a href="#cb25-536" aria-hidden="true" tabindex="-1"></a>    de <span class="op">=</span> element.getde()</span>
<span id="cb25-537"><a href="#cb25-537" aria-hidden="true" tabindex="-1"></a>    strain_e <span class="op">=</span> np.matmul(element.Be,de)</span>
<span id="cb25-538"><a href="#cb25-538" aria-hidden="true" tabindex="-1"></a>    stress_e <span class="op">=</span> np.matmul(D, strain_e)</span>
<span id="cb25-539"><a href="#cb25-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-540"><a href="#cb25-540" aria-hidden="true" tabindex="-1"></a>    dx_avg <span class="op">=</span> average([de[<span class="dv">0</span>], de[<span class="dv">2</span>], de[<span class="dv">4</span>]])</span>
<span id="cb25-541"><a href="#cb25-541" aria-hidden="true" tabindex="-1"></a>    dy_avg <span class="op">=</span> average([de[<span class="dv">1</span>], de[<span class="dv">3</span>], de[<span class="dv">5</span>]])</span>
<span id="cb25-542"><a href="#cb25-542" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-543"><a href="#cb25-543" aria-hidden="true" tabindex="-1"></a>    element.strain <span class="op">=</span> strain_e</span>
<span id="cb25-544"><a href="#cb25-544" aria-hidden="true" tabindex="-1"></a>    element.stress <span class="op">=</span> stress_e</span>
<span id="cb25-545"><a href="#cb25-545" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-546"><a href="#cb25-546" aria-hidden="true" tabindex="-1"></a>    element.colorVal <span class="op">=</span> calculateVonMises(element.stress[<span class="dv">0</span>], element.stress[<span class="dv">1</span>], element.stress[<span class="dv">2</span>])</span>
<span id="cb25-547"><a href="#cb25-547" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-548"><a href="#cb25-548" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> element.colorVal <span class="op">&gt;</span> Element.maxColorVal:</span>
<span id="cb25-549"><a href="#cb25-549" aria-hidden="true" tabindex="-1"></a>        Element.maxColorVal <span class="op">=</span> element.colorVal</span>
<span id="cb25-550"><a href="#cb25-550" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> element.colorVal <span class="op">&lt;</span> Element.minColorVal:</span>
<span id="cb25-551"><a href="#cb25-551" aria-hidden="true" tabindex="-1"></a>        Element.minColorVal <span class="op">=</span> element.colorVal</span>
<span id="cb25-552"><a href="#cb25-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-553"><a href="#cb25-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-556"><a href="#cb25-556" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb25-557"><a href="#cb25-557" aria-hidden="true" tabindex="-1"></a>render <span class="op">=</span> drawMesh.MeshRender()</span>
<span id="cb25-558"><a href="#cb25-558" aria-hidden="true" tabindex="-1"></a>render.legend <span class="op">=</span> <span class="va">True</span></span>
<span id="cb25-559"><a href="#cb25-559" aria-hidden="true" tabindex="-1"></a>render.autoScale <span class="op">=</span> <span class="va">True</span></span>
<span id="cb25-560"><a href="#cb25-560" aria-hidden="true" tabindex="-1"></a>render.deform_scale <span class="op">=</span> <span class="fl">1.0e5</span></span>
<span id="cb25-561"><a href="#cb25-561" aria-hidden="true" tabindex="-1"></a>render.legendDiscretize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb25-562"><a href="#cb25-562" aria-hidden="true" tabindex="-1"></a>render.legendTitle <span class="op">=</span> <span class="st">'von-mises (Pa)'</span></span>
<span id="cb25-563"><a href="#cb25-563" aria-hidden="true" tabindex="-1"></a>render.drawElements(elements)</span>
<span id="cb25-564"><a href="#cb25-564" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb25-565"><a href="#cb25-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-566"><a href="#cb25-566" aria-hidden="true" tabindex="-1"></a><span class="al">![](pictures/vonmises_highres_x.png)</span>{width=100% fig-align="center"}</span>
<span id="cb25-567"><a href="#cb25-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-568"><a href="#cb25-568" aria-hidden="true" tabindex="-1"></a>If we rerun the code changing the force direction downwards we get the following result:</span>
<span id="cb25-569"><a href="#cb25-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-570"><a href="#cb25-570" aria-hidden="true" tabindex="-1"></a><span class="al">![](pictures/vonmises_highres_y_log.png)</span>{width=100% fig-align="center"}</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>